{% extends "base.html" %}
{% block title %}AI Security Copilot | SecureChain{% endblock %}
{% block content %}
<section class="rounded-3xl border border-violet-400/20 bg-slate-900/60 p-6 shadow-violet backdrop-blur-xl">
    <h1 class="text-2xl font-bold text-violet-200">AI Security Copilot</h1>
    <p class="mt-2 text-sm text-slate-300">Advanced guided assistant for fraud triage, policy workflows, blockchain integrity interpretation, and operational next steps.</p>
    <p class="mt-1 text-xs text-slate-400">PDF reports and certificates are generated by background workers for production-safe response times.</p>
</section>

<section class="mt-6 grid gap-6 lg:grid-cols-3">
    <article class="rounded-2xl border border-slate-700/40 bg-slate-900/50 p-5 lg:col-span-2">
        <div id="chat-box" class="h-[420px] space-y-3 overflow-y-auto rounded-xl border border-slate-700/40 bg-slate-900/40 p-4">
            <div class="rounded-xl border border-violet-400/30 bg-violet-500/10 p-3 text-sm text-violet-100">
                I can analyze risk context, explain blockchain integrity, and provide role-specific playbooks for users and admins.
            </div>
        </div>
        <form id="chat-form" class="mt-4 space-y-3">
            <input type="hidden" id="csrf-token" value="{{ csrf_token() }}">
            <div class="grid gap-3 md:grid-cols-3">
                <input id="message-input" required placeholder="Ask a security question..." class="md:col-span-2 rounded-xl border border-slate-600 bg-slate-900 px-3 py-2 text-sm outline-none ring-violet-300 focus:ring">
                <select id="verification-id" class="rounded-xl border border-slate-600 bg-slate-900 px-3 py-2 text-sm">
                    <option value="">No specific record</option>
                    {% for record in records %}
                        <option value="{{ record.verification_id }}">{{ record.verification_id }} - {{ record.original_filename }}</option>
                    {% endfor %}
                </select>
            </div>
            <button class="rounded-xl bg-violet-400 px-4 py-2 text-sm font-semibold text-slate-900 transition hover:bg-violet-300">
                Ask AI Copilot
            </button>
        </form>
    </article>

    <article class="rounded-2xl border border-cyan-400/20 bg-slate-900/50 p-5">
        <h2 class="text-lg font-semibold text-cyan-200">AI Report Generator</h2>
        <p class="mt-2 text-xs text-slate-400">Choose a record and export a PDF security report or certificate.</p>
        <div class="mt-4 space-y-2">
            {% for record in records[:8] %}
                <div class="rounded-xl border border-slate-700/40 bg-slate-900/40 p-3 text-xs">
                    <p class="font-mono text-cyan-200">{{ record.verification_id }}</p>
                    <p class="text-slate-300">{{ record.original_filename }}</p>
                    <div class="mt-2 flex gap-2">
                        <a href="{{ url_for('main.download_report', verification_id=record.verification_id) }}" class="chip-link">PDF Report</a>
                        <a href="{{ url_for('main.download_certificate', verification_id=record.verification_id) }}" class="chip-link">Certificate</a>
                    </div>
                </div>
            {% else %}
                <p class="text-sm text-slate-400">No records available yet.</p>
            {% endfor %}
        </div>
    </article>
</section>
{% endblock %}

{% block scripts %}
<script>
    window.SecureChain = window.SecureChain || {};
    window.SecureChain.assistant = true;
</script>
{% endblock %}
