{% extends "base.html" %}
{% block title %}Integrity Center | SecureChain{% endblock %}
{% block content %}
<section class="rounded-3xl border border-fuchsia-400/20 bg-slate-900/60 p-6 shadow-violet backdrop-blur-xl">
    <div class="flex flex-wrap items-start justify-between gap-3">
        <div>
            <h1 class="text-2xl font-bold text-fuchsia-200">Integrity Center</h1>
            <p class="mt-2 text-sm text-slate-300">Run deep storage + hash + blockchain consistency scans and monitor incident follow-ups.</p>
        </div>
        <form method="POST" action="{{ url_for('main.run_integrity_scan') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="rounded-xl bg-fuchsia-400 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-fuchsia-300">Run Full Integrity Scan</button>
        </form>
    </div>
</section>

<section class="mt-6 grid gap-6 xl:grid-cols-2">
    <article class="rounded-2xl border border-cyan-400/20 bg-slate-900/50 p-5">
        <h2 class="text-lg font-semibold text-cyan-200">Recent Scan History</h2>
        <div class="mt-4 space-y-2 text-xs">
            {% for scan in scans %}
                <details class="rounded-xl border border-slate-700/40 bg-slate-900/40 p-3">
                    <summary class="cursor-pointer font-mono text-cyan-200">
                        {{ scan.scan_id }} | Failed {{ scan.failed_records }}/{{ scan.total_records }} | {{ scan.run_at[:19] }} UTC
                    </summary>
                    <p class="mt-2 text-slate-400">Run by {{ scan.run_by_username }} ({{ scan.run_by }})</p>
                    <pre class="mt-2 max-h-56 overflow-y-auto rounded-lg bg-slate-950/70 p-2 text-[11px] text-slate-300 whitespace-pre-wrap">{{ scan.issue_summary_json }}</pre>
                </details>
            {% else %}
                <p class="text-slate-400">No scans recorded yet.</p>
            {% endfor %}
        </div>
    </article>

    <article class="rounded-2xl border border-rose-400/20 bg-slate-900/50 p-5">
        <h2 class="text-lg font-semibold text-rose-200">Incident Follow-up Queue</h2>
        <div class="mt-4 space-y-2 text-xs">
            {% for incident in incidents %}
                <div class="rounded-xl border border-slate-700/40 bg-slate-900/40 p-3">
                    <p class="font-mono text-rose-200">{{ incident.incident_id }} | {{ incident.status|upper }}</p>
                    <p class="text-slate-300">{{ incident.title }}</p>
                    <p class="text-slate-500">VID {{ incident.verification_id }} | {{ incident.updated_at[:19] }} UTC</p>
                    {% if incident.resolution_note %}
                        <p class="mt-1 text-slate-400">Resolution: {{ incident.resolution_note }}</p>
                    {% endif %}
                </div>
            {% else %}
                <p class="text-slate-400">No incidents yet.</p>
            {% endfor %}
        </div>
    </article>
</section>
{% endblock %}
